# 匯入所需套件
import argparse               # 用於命令列參數解析（可讓使用者從命令列輸入設定）
import pandas as pd           # 資料處理：讀取與操作 CSV、DataFrame 等結構化資料
import numpy as np            # 數值運算：陣列、隨機數、數學運算
from sklearn.model_selection import KFold  # K 折交叉驗證（將資料分成 K 份用於模型訓練與驗證）
from sklearn.feature_extraction.text import TfidfVectorizer  # 將文字轉換為 TF-IDF 特徵向量
from sklearn.linear_model import Ridge   # 岭迴歸（Ridge Regression）模型，用於預測連續變數
from sklearn.pipeline import make_pipeline  # 串接處理流程（例如先文字轉換，再模型訓練）
from sklearn.metrics import mean_squared_error  # 評估模型誤差（MSE）
from scipy.stats import pearsonr  # 用於計算皮爾森相關係數（Pearson correlation）
import random                     # 控制隨機性（隨機打亂資料時使用）

# -----------------------------
# 固定隨機種子，使結果可重現
# -----------------------------
def set_seed(seed=42):
    np.random.seed(seed)   # 設定 NumPy 隨機種子
    random.seed(seed)      # 設定 Python 內建 random 隨機種子

# -----------------------------
# 計算皮爾森相關係數（Pearson correlation）
# -----------------------------
def pearson(y_true, y_pred):
    # 若真實值或預測值皆為常數（無變化），皮爾森相關無法計算 → 回傳 0
    if len(np.unique(y_true)) < 2 or len(np.unique(y_pred)) < 2:
        return 0.0
    # 計算真實值與預測值的皮爾森相關係數
    # pearsonr() 回傳一個物件，.statistic 為相關係數（介於 -1 到 1）
    return pearsonr(y_true, y_pred).statistic
